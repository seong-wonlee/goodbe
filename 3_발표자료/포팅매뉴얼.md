# 포팅 메뉴얼

## 1. Stacks

### Front-End
- React 

### Back-End & DB
- Java OpenJDK 17.0.2
- SpringBoot 2.7.14
- Gradle 8.1.1
- H2 Database 1.4.200
- mariaDB 10.3.38

### Infra
- AWS EC2
- Docker version 20.10.25
- Nginx nginx/1.18.0 

### Tools
- Intellij IDEA
- Visual Studio Code
- Mattermost
- Discord
- MobaXterm
- MySql Wrokbench

## 2. Build & Distribute

### Ports
| 3000 | Frontend |
| --- | --- |
| 3306 | MariaDB |
| 8000 | Analysis |
| 8080 | Jenkins |
| 8081 | Business |
| 8082 | H2 DB |
| 8083 | Search |
| 8089 | Authorization |
| 8091 | WebRTC |
| 8092 | Chatting |

### Nginx
- Nginx config file
```yaml
server {
        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                root /home/ubuntu/project/client/build;
		index index.html index.htm;
		try_files $uri $uri/ /index.html;
        }
}

server {
        root /home/ubuntu/project/client/build;

        # Add index.php to the list if you are using PHP
        index index.html index.htm;
    	server_name i9a801.p.ssafy.io; # managed by Certbot

        location / {
                try_files $uri $uri/ /index.html;
        }

	location /api{
		proxy_pass http://127.0.0.1:8081;
	}

	location /search{
		proxy_pass http://127.0.0.1:8083;
	}

	location /auth{
		proxy_pass http://127.0.0.1:8089;
	}

	location /analysis{
		proxy_pass http://127.0.0.1:8000;

	        add_header 'Access-Control-Allow-Origin' 'https://i9a801.p.ssafy.io';
	        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
	        add_header 'Access-Control-Allow-Headers' 'Authorization, Origin, X-Requested-With, Content-Type, Accept';
	}

	location /chat{
		proxy_pass http://127.0.0.1:8092;
	}

	location /rtc{
		proxy_pass http://127.0.0.1:8091;
	}
	
	location /rtc/{
		proxy_pass http://127.0.0.1:8091;
	}
       

    # listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/i9a801.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/i9a801.p.ssafy.io/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # 
}
server {
    if ($host = i9a801.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot
        listen 80 ;
        listen [::]:80 ;
    server_name i9a801.p.ssafy.io;
    return 404; # managed by Certbot
}

```

# 3. Deployment Command

### React Storybook

### Frontend

### Backend

### Nginx Web Server

# 4. MySQL WorkBench Connection

### Spring Boot에서 연결

- local - application.yml

```yaml
datasource:
	url: jdbc:h2:tcp://localhost/~/goodbe
	username: sa
	password:
	driver-class-name: org.h2.Driver
```

- remote - application-prod.yml

```yaml
datasource:
	driver-class-name: org.mariadb.jdbc.Driver
	url: jdbc:mariadb://[url]:3306/[DB이름]
	username: [DB유저이름]
	password: [비밀번호]
```

# 5. How to use The MongoDB Compass

# 6. Nginx default

# 7. EC2 Setting

# 8. Files ignored

- **business:** application-prod.yml
- **auth:** application.yml